"use strict";var classie=require("classie"),extend=require("util-extend"),domhelper=require("domhelper"),slimscroll=function(e,t){function s(){E||(E=L),C=Math.max(b.offsetHeight/b.scrollHeight*b.offsetHeight,z),E.style.height=C+"px";var e=b.offsetHeight===C?"none":"block";E.style.display=e}function l(e,t,s,l,a,r){M=!1;var n=e;b=l,a=a||b.parentNode.querySelector("."+V.barClass);var d=b.offsetHeight-a.offsetHeight;if(t?(n=parseInt(a.style.top,10)+e*parseInt(V.wheelStep,10)/100*a.offsetHeight,n=Math.min(Math.max(n,0),d),n=e>0?Math.ceil(n):Math.floor(n),a.style.top=n+"px"):r&&(q=parseInt(a.style.top,10)/(b.offsetHeight-a.offsetHeight),n=q*(b.scrollHeight-b.offsetHeight),a.style.top=n+"px"),q=parseInt(a.style.top,10)/(b.offsetHeight-a.offsetHeight),n=q*(b.scrollHeight-b.offsetHeight),s){n=e;var c=n/b.scrollHeight*b.offsetHeight;c=Math.min(Math.max(c,0),d),a.style.top=c+"px"}b.scrollTop=n;var p=document.createEvent("Event");p.initEvent("slimscrolling",!0,!0,"blah"),b.dispatchEvent(p,~~n),i(),o()}function i(){if(s(),clearTimeout(I),q===~~q){if(M=V.allowPageScroll,B!==q){var e=0==~~q?"top":"bottom",t=document.createEvent("Event");t.initEvent("slimscroll",!0,!0),b.dispatchEvent(t,e)}}else M=!1;if(B=q,C>=b.offsetHeight)return void(M=!0);E.style.transition="opacity .5s",E.style.opacity=V.opacity,V.railVisible&&(w.style.transform="opacity .5s",w.style.opacity=1)}function o(){V.alwaysVisible||(I=setTimeout(function(){V.disableFadeOut&&D||N||x||(E.style.transition="opacity 1s",E.style.opacity=0,w.style.transition="opacity 1s",w.style.opacity=0)},500))}function a(e){if(D){var t=0;e.wheelDelta&&(t=-e.wheelDelta/120),e.detail&&(t=e.detail/3);var s=e.target,i=domhelper.getParentElement(s,V.wrapperClass);i?l(t,!0,null,i.querySelector("."+V.addedOriginalClass)):console.log("not the right parent node"),M||e.preventDefault()}}function r(e){var t=e.target;return L=t,x=!0,S=parseInt(t.style.top,10),H=e.pageY,L&&L.addEventListener("mousemove",n),e.preventDefault(),!1}function n(e){var t=S+e.pageY-H;L&&(L.style.top=t,l(0,domhelper.getPosition(L).top,!1,b,L))}function d(e){x=!1,L&&(o(L),L.removeEventListener("mousemove",n))}function c(e){N=!0}function p(e){N=!1}function h(e){return!1}function u(e){i()}function y(e){o()}function f(e){D=!0,i(E),o(E)}function g(e){D=!0,i(E),o(E)}function m(e){e.touches.length&&(R=e.touches[0].pageY)}function v(e){if(M||e.preventDefault(),e.touches.length){l((R-e.touches[0].pageY)/V.touchScrollStep,!0,null,b,L,!0),R=e.touches[0].pageY}}var b,w,E,C,H,S,x,L,R,M,N,q,I,B,D,O={idSelector:"body",width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,addedOriginalClass:"originalScrollableElement",borderRadius:"7px",railBorderRadius:"7px"},V=extend(O,e),k=t||document.querySelectorAll(e.idSelector),z=30;this.init=function(){for(var t=0;t<k.length;t++){if(M=!1,b=k[t],classie.addClass(b,V.addedOriginalClass),classie.hasClass(b.parentNode,V.wrapperClass)){var i=b.scrollTop;if(E=b.parentNode.querSelector("."+V.barClass),w=b.parentNode.querSelector("."+V.railClass),s(),"object"==typeof e){if("height"in e&&"auto"===e.height){b.parentNode.style.height="auto",b.style.height="auto";var o=b.parentNode.parentNode.scrollHeight;b.parent.style.height=o,b.style.height=o}if("scrollTo"in e)i=parseInt(V.scrollTo,10);else if("scrollBy"in e)i+=parseInt(V.scrollBy,10);else if("destroy"in e)return domhelper.removeElement(E),domhelper.removeElement(w),void domhelper.unwrapElement(b);l(i,!1,!0,b)}return}V.height="auto"===e.height?b.parentNode.offsetHeight:e.height;var n=document.createElement("div");classie.addClass(n,V.wrapperClass),n.style.position="relative",n.style.overflow="hidden",n.style.width=V.width,n.style.height=V.height,b.style.overflow="hidden",b.style.width=V.width,b.style.height=V.height,w=document.createElement("div"),classie.addClass(w,V.railClass),w.style.width=V.size,w.style.height="100%",w.style.position="absolute",w.style.top=0,w.style.display=V.alwaysVisible&&V.railVisible?"block":"none",w.style["border-radius"]=V.railBorderRadius,w.style.background=V.railColor,w.style.opacity=V.railOpacity,w.style.zIndex=90,E=document.createElement("div"),classie.addClass(E,V.barClass),E.style.background=V.color,E.style.width=V.size,E.style.position="absolute",E.style.top=0,E.style.opacity=V.opacity,E.style.display=V.alwaysVisible?"block":"none",E.style["border-radius"]=V.borderRadius,E.style.BorderRadius=V.borderRadius,E.style.MozBorderRadius=V.borderRadius,E.style.WebkitBorderRadius=V.borderRadius,E.style.zIndex=99,"right"===V.position?(w.style.right=V.distance,E.style.right=V.distance):(w.style.left=V.distance,E.style.left=V.distance),domhelper.elementWrap(b,n),b.parentNode.appendChild(E),b.parentNode.appendChild(w),s(),E.addEventListener("mousedown",r),document.addEventListener("mouseup",d),E.addEventListener("selectstart",h),E.addEventListener("mouseover",c),E.addEventListener("mouseleave",p),E.addEventListener("touchstart",m),w.addEventListener("mouseover",u),w.addEventListener("mouseleave",y),b.addEventListener("mouseover",f),b.addEventListener("mouseleave",g),b.addEventListener("DOMMouseScroll",a,!1),b.addEventListener("mousewheel",a,!1)}"bottom"===V.start?(E.style.top=b.offsetHeight-E.offsetHeight,l(0,!0)):"top"!==V.start&&(l(domhelper.getPosition(document.querSelector(V.start).top,null,!0)),V.alwaysVisible||domhelper.elementHideCss(E)),document.addEventListener("touchmove",v)}.bind(this)};module.exports=slimscroll,"object"==typeof window&&"object"==typeof window.document&&(window.slimscroll=slimscroll);